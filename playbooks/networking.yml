- name: Network Configuration and Management
  hosts: all
  become: true
  gather_facts: true
  pre_tasks:
    - name: Check connectivity
      ping:
      register: ping_result
      ignore_errors: true
  tasks:
    - name: Install firewall package (RedHat)
      package:
        name: firewalld
        state: present
      when: ansible_os_family == "RedHat"
      register: firewall_install
      ignore_errors: true
    - name: Install firewall package (Debian)
      package:
        name: iptables
        state: present
      when: ansible_os_family == "Debian"
      register: firewall_install
      ignore_errors: true
    - name: Ensure firewall service is running (RedHat)
      service:
        name: firewalld
        state: started
        enabled: yes
      when: ansible_os_family == "RedHat" and firewall_install is success
    - name: Get network interfaces
      command: ip a
      register: net_interfaces
      changed_when: false
    - name: Display network interfaces
      debug:
        msg: "{{ net_interfaces.stdout_lines }}"
    - name: Check network connectivity
      command: ping -c 4 8.8.8.8
      register: ping_test
      changed_when: false
      ignore_errors: true
    - name: Display connectivity status
      debug:
        msg: "Network connectivity: {{ 'OK' if ping_test is success else 'FAILED' }}"
    - name: Ensure network manager is installed
      package:
        name: "{{ item }}"
        state: present
      loop:
        - NetworkManager
        - net-tools
      ignore_errors: true
